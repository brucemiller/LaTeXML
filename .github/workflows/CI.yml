name: CI

on: [push, pull_request]

jobs:
  ci:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/tkw1536/latexml-test-runtime:${{ matrix.texlive }}-${{ matrix.perl }}
      env:
        CI: true
      options: --entrypoint ""

    name: TexLive ${{ matrix.texlive }} / Perl ${{ matrix.perl }}
    strategy:
      matrix:
        include:
          - perl: "5.28"
            texlive: none
          - perl: "5.26"
            texlive: none
          - perl: "5.24"
            texlive: none
          - perl: "5.20"
            texlive: none
          - perl: "5.14"
            texlive: none
          - perl: "5.28"
            texlive: "2018"
          - perl: "5.24"
            texlive: "2016"
          - perl: "5.22"
            texlive: "2015"
    
    steps:
      - uses: actions/checkout@v2
      - name: Print Program Versions
        shell: bash
        run: |
          source /usr/local/perlbrew/etc/bashrc
          perl --version
          cpanm --version
          tex --version || true
      - name: Install Dependencies
        shell: bash
        run: |
          source /usr/local/perlbrew/etc/bashrc
          cpanm -v --installdeps --notest .
      - name: Run 'make'
        shell: bash
        run: |
          source /usr/local/perlbrew/etc/bashrc
          perl Makefile.PL
          make
      - name: Run 'make test'
        shell: bash
        run: |
          source /usr/local/perlbrew/etc/bashrc
          make test